<head>
   <!-- Import jQuery -->
<style>

html, body, #map {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}

.stations, .stations svg {
  position: absolute;
}

.stations svg {
  width: 60px;
  height: 20px;
  padding-right: 100px;
  font: 10px sans-serif;
}

.stations circle {
  fill: brown;
  stroke: black;
  stroke-width: 1.5px;
}

</style>
</head>
<body id="main">
   <p>Enter a city: </p>
   <input type="text" id="city-input">
   <button id='run-get'>Find City Stuff</button>
   <br>
   <div id="map"></div>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
   <script src="//maps.google.com/maps/api/js?sensor=true"></script>
   <script src="//d3js.org/d3.v3.min.js"></script>
   <script>
   /*$('#run-get').click(function(){
      //sample HTTP GET request using ajax
      var fake_data=$("#num-input").val();

      $.ajax({
         type:"GET",
         url:"/testget/" + fake_data,
         success: function(response){
            console.log(response);
            $("body").append('<p>' + JSON.stringify(response) + '</p>');
         },
         error: function(error){
            console.log(error);
         }
      });
   });

   $('#run-post').click(function(){
      //sample HTTP POST request using ajax
      var post_data={
         'my_string':"Hello World!",
         'my_int':12,
         'my_arr':[0,2,4,6,8],
         'my_nested_object':{
            'name':'Fred',
            'age':21,
            'sex':'M'
         }
      }
      $.ajax({
         type:"POST",
         url:"/testpost",
         data: JSON.stringify(post_data),
         success: function(response){
            console.log(response);
            $("body").append('<p>' + JSON.stringify(response) + '</p>');
         },
         error: function(error){
            console.log(error);
         }
      });
   });*/
   $('#run-get').click(function(){
      var city = $('#city-input').val();


   var map = new google.maps.Map(d3.select("#map").node(), {
     zoom: 8,
     center: new google.maps.LatLng(37.76487, -122.41948),
     mapTypeId: google.maps.MapTypeId.TERRAIN
   });
   // Create the Google Map…
   d3.json('/testd3/' + city, function(error, data){

      // Load the station data. When the data comes back, create an overlay.
        if (error) throw error;

        var overlay = new google.maps.OverlayView();

        // Add the container when the overlay is added to the map.
        overlay.onAdd = function() {
          var layer = d3.select(this.getPanes().overlayLayer).append("div")
              .attr("class", "stations");

          // Draw each marker as a separate SVG element.
          // We could use a single SVG, but what size would it have?
          overlay.draw = function() {
            var projection = this.getProjection(),
                padding = 10;

            var marker = layer.selectAll("svg")
                .data(d3.entries(data))
                .each(transform) // update existing markers
              .enter().append("svg")
                .each(transform)
                .attr("class", "marker");

            // Add a circle.
            marker.append("circle")
                .attr("r", 4.5)
                .attr("cx", padding)
                .attr("cy", padding);

            // Add a label.
            marker.append("text")
                .attr("x", padding + 7)
                .attr("y", padding)
                .attr("dy", ".31em")
                .text(function(d) { return d.key; });

            function transform(d) {
              d = new google.maps.LatLng(d.value[1], d.value[0]);
              d = projection.fromLatLngToDivPixel(d);
              return d3.select(this)
                  .style("left", (d.x - padding) + "px")
                  .style("top", (d.y - padding) + "px");
            }
          };
        };

     // Bind our overlay to the map…
     overlay.setMap(map);
      });
   });


   </script>
</body>



